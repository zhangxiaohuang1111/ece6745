#=========================================================================
# ProcDpathImmGen unit tests
#=========================================================================

from pymtl3 import *
from pymtl3.stdlib.test_utils import run_test_vector_sim

from proc.ProcDpathImmGen import ProcDpathImmGen

#-------------------------------------------------------------------------
# test I-type
#-------------------------------------------------------------------------

def test_immgen_i( cmdline_opts ):
  dut = ProcDpathImmGen()

  run_test_vector_sim( dut, [
    ('imm_type inst                                imm*'),
    [ 0,       0b11111111111100000000000000000000, 0b11111111111111111111111111111111],
    [ 0,       0b00000000000011111111111111111111, 0b00000000000000000000000000000000],
    [ 0,       0b01111111111100000000000000000000, 0b00000000000000000000011111111111],
    [ 0,       0b11111111111000000000000000000000, 0b11111111111111111111111111111110],
  ], cmdline_opts )

#-------------------------------------------------------------------------
# test B-type
#-------------------------------------------------------------------------

def test_immgen_b( cmdline_opts ):
  dut = ProcDpathImmGen()

  run_test_vector_sim( dut, [
    ('imm_type inst                                imm*'),
    [ 2,       0b11111110000000000000111110000000, 0b11111111111111111111111111111110],
    [ 2,       0b00000001111111111111000001111111, 0b00000000000000000000000000000000],
    [ 2,       0b11000000000000000000111100000000, 0b11111111111111111111010000011110],
  ], cmdline_opts )

#'''' LAB TASK '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
#  Add more tests for immediate types
#'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''\/

#-------------------------------------------------------------------------
# test S-type
#-------------------------------------------------------------------------

def test_immgen_s( cmdline_opts ):
  dut = ProcDpathImmGen()

  run_test_vector_sim( dut, [
    ('imm_type inst                                imm*'),
    [ 1,       0b11111110000000000000111110000000, 0b11111111111111111111111111111111],
    [ 1,       0b00000001111111111111000001111111, 0b00000000000000000000000000000000],
    [ 1,       0b01111110000000000000111110000000, 0b00000000000000000000011111111111],
    [ 1,       0b11111110000000000000111100000000, 0b11111111111111111111111111111110],
  ], cmdline_opts )

#-------------------------------------------------------------------------
# test U-type
#-------------------------------------------------------------------------

def test_immgen_u( cmdline_opts ):
  dut = ProcDpathImmGen()

  run_test_vector_sim( dut, [
    ('imm_type inst                                imm*'),
    [ 3,       0b11111111111111111111000000000000, 0b11111111111111111111000000000000],
    [ 3,       0b00000000000000000000111111111111, 0b00000000000000000000000000000000],
  ], cmdline_opts )

#-------------------------------------------------------------------------
# test J-type
#-------------------------------------------------------------------------

def test_immgen_j( cmdline_opts ):
  dut = ProcDpathImmGen()

  run_test_vector_sim( dut, [
    ('imm_type inst                                imm*'),
    [ 4,       0b11111111111111111111000000000000, 0b11111111111111111111111111111110],
    [ 4,       0b00000000000000000001111111111111, 0b00000000000000000001000000000000],
    [ 4,       0b01000000000010011001000000000000, 0b00000000000010011001010000000000],
  ], cmdline_opts )

#'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''/\
